<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منظومة إدارة الكلية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root { --primary-bg: #2c3e50; --secondary-bg: #34495e; --primary-accent: #3498db; --text-color: #ecf0f1; --content-bg: #ffffff; --content-text: #333; --danger-color: #e74c3c; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; display: flex; }
        .sidebar { width: 250px; background-color: var(--primary-bg); color: var(--text-color); height: 100vh; padding: 20px; box-sizing: border-box; position: fixed; display: flex; flex-direction: column; }
        .sidebar h1 { text-align: center; margin-bottom: 30px; font-size: 22px; }
        .sidebar .nav-link { display: block; color: var(--text-color); text-decoration: none; padding: 15px; margin-bottom: 10px; border-radius: 8px; transition: background-color 0.3s; cursor: pointer; }
        .sidebar .nav-link.active, .sidebar .nav-link:hover { background-color: var(--primary-accent); }
        .sidebar .nav-link i { margin-left: 15px; }
        .sidebar .logout { margin-top: auto; color: var(--danger-color); }
        .main-content { margin-right: 250px; width: calc(100% - 250px); padding: 30px; box-sizing: border-box; }
        .page { display: none; }
        .page.active { display: block; }
        .card { background-color: var(--content-bg); padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: var(--content-text); border-bottom: 2px solid var(--primary-accent); padding-bottom: 10px; margin-top: 0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; align-items: end; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        button { padding: 12px 18px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 14px; color: white; background-color: var(--primary-accent); }
        .btn-danger { background-color: var(--danger-color); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background-color: #f5f6f7; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h1><i class="fas fa-university"></i> منظومة الكلية</h1>
        <a data-page="users" class="nav-link active"><i class="fas fa-users"></i> إدارة المستخدمين</a>
        <a data-page="halls" class="nav-link"><i class="fas fa-door-open"></i> إدارة القاعات</a>
        <a data-page="schedules" class="nav-link"><i class="fas fa-calendar-alt"></i> جدول المحاضرات</a>
        <a id="logout-link" class="nav-link logout"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a>
    </div>

    <div class="main-content">
        <!-- Users Page -->
        <div id="users" class="page active">
            <div class="card">
                <h2>إضافة مستخدم جديد</h2>
                <div class="form-grid">
                    <input id="user-displayName" type="text" placeholder="الاسم الكامل (displayName)">
                    <input id="user-username" type="text" placeholder="اسم المستخدم (User name)">
                    <input id="user-password" type="password" placeholder="كلمة المرور (Password)">
                    <input id="user-role" type="text" placeholder="الدور (role)">
                    <button id="add-user-btn">إضافة مستخدم</button>
                </div>
            </div>
            <div class="card">
                <h2>قائمة المستخدمين</h2>
                <table id="users-table">
                    <thead><tr><th>الاسم</th><th>اسم المستخدم</th><th>الدور</th><th>إجراءات</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Halls Page -->
        <div id="halls" class="page">
            <div class="card">
                <h2>إضافة قاعة جديدة</h2>
                <div class="form-grid">
                    <input id="hall-name" type="text" placeholder="اسم القاعة (Name)">
                    <input id="hall-capacity" type="number" placeholder="السعة (سعة)">
                    <button id="add-hall-btn">إضافة قاعة</button>
                </div>
            </div>
            <div class="card">
                <h2>قائمة القاعات</h2>
                <table id="halls-table">
                    <thead><tr><th>اسم القاعة</th><th>السعة</th><th>إجراءات</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Schedules Page -->
        <div id="schedules" class="page">
             <div class="card">
                <h2>إضافة محاضرة جديدة</h2>
                <div class="form-grid">
                    <input id="schedule-subject" type="text" placeholder="اسم المادة (Subject)">
                    <input id="schedule-teacher" type="text" placeholder="اسم المحاضر (Name)">
                    <button id="add-schedule-btn">إضافة محاضرة</button>
                </div>
            </div>
            <div class="card">
                <h2>جدول المحاضرات</h2>
                <table id="schedules-table">
                    <thead><tr><th>المادة</th><th>المحاضر</th><th>إجراءات</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // --- Firebase Configuration ---
        const firebaseConfig = {
          apiKey: "AIzaSyBvBj7uYIM7m0WiZonfVGyS3CJjh8RaZOA",
          authDomain: "gggg-dc7d0.firebaseapp.com",
          projectId: "gggg-dc7d0",
          storageBucket: "gggg-dc7d0.appspot.com",
          messagingSenderId: "151376454562",
          appId: "1:151376454562:web:1dc3064431b5c7e35388fb",
          measurementId: "G-RQY8V4RZNS"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Navigation Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.sidebar .nav-link');
            const pages = document.querySelectorAll('.main-content .page');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    if (!pageId) return;
                    pages.forEach(p => p.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });
            
            loadAllData();

            document.getElementById('add-user-btn').addEventListener('click', addUser);
            document.getElementById('add-hall-btn').addEventListener('click', addHall);
            document.getElementById('add-schedule-btn').addEventListener('click', addSchedule);
            document.getElementById('logout-link').addEventListener('click', () => {
                window.location.href = 'login.html';
            });
        });

        function loadAllData() {
            loadUsers();
            loadHalls();
            loadSchedules();
        }

        // --- Users Management (ADAPTED 100%) ---
        async function addUser() {
            const displayName = document.getElementById('user-displayName').value;
            const username = document.getElementById('user-username').value;
            const password = document.getElementById('user-password').value;
            const role = document.getElementById('user-role').value;

            if (!displayName || !username || !password) {
                alert('يرجى ملء جميع الحقول');
                return;
            }

            try {
                await db.collection('Users').add({ 
                    displayName: displayName,
                    "User name": username, // With space
                    Password: password,
                    role: role
                });
                alert('تمت إضافة المستخدم بنجاح');
                loadUsers();
            } catch (error) {
                console.error("Error adding user: ", error);
                alert('حدث خطأ أثناء إضافة المستخدم');
            }
        }

        async function loadUsers() {
            const tableBody = document.querySelector('#users-table tbody');
            tableBody.innerHTML = '';
            try {
                const snapshot = await db.collection('Users').get();
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const row = `
                        <tr>
                            <td>${user.displayName}</td>
                            <td>${user["User name"]}</td>
                            <td>${user.role}</td>
                            <td><button class="btn-danger" onclick="deleteDocument('Users', '${doc.id}', loadUsers)">حذف</button></td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            } catch (error) { console.error("Error loading users: ", error); }
        }

        // --- Halls Management (ADAPTED 100%) ---
        async function addHall() {
            const name = document.getElementById('hall-name').value;
            const capacity = document.getElementById('hall-capacity').value;
            if (!name) { alert('يرجى إدخال اسم القاعة'); return; }
            try {
                await db.collection('Room').add({ Name: name, "سعة": capacity });
                alert('تمت إضافة القاعة بنجاح');
                loadHalls();
            } catch (error) { console.error("Error adding hall: ", error); alert('حدث خطأ'); }
        }

        async function loadHalls() {
            const tableBody = document.querySelector('#halls-table tbody');
            tableBody.innerHTML = '';
            try {
                const snapshot = await db.collection('Room').get();
                snapshot.forEach(doc => {
                    const hall = doc.data();
                    const row = `
                        <tr>
                            <td>${hall.Name}</td>
                            <td>${hall["سعة"]}</td>
                            <td><button class="btn-danger" onclick="deleteDocument('Room', '${doc.id}', loadHalls)">حذف</button></td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            } catch (error) { console.error("Error loading halls: ", error); }
        }

        // --- Schedules Management (ADAPTED 100%) ---
        async function addSchedule() {
            const subject = document.getElementById('schedule-subject').value;
            const teacher = document.getElementById('schedule-teacher').value;
            if (!subject || !teacher) { alert('يرجى ملء الحقول'); return; }
            try {
                await db.collection('Teachers').add({ Subject: subject, Name: teacher });
                alert('تمت إضافة المحاضرة بنجاح');
                loadSchedules();
            } catch (error) { console.error("Error adding schedule: ", error); alert('حدث خطأ'); }
        }

        async function loadSchedules() {
            const tableBody = document.querySelector('#schedules-table tbody');
            tableBody.innerHTML = '';
            try {
                const snapshot = await db.collection('Teachers').get();
                snapshot.forEach(doc => {
                    const schedule = doc.data();
                    const row = `
                        <tr>
                            <td>${schedule.Subject}</td>
                            <td>${schedule.Name}</td>
                            <td><button class="btn-danger" onclick="deleteDocument('Teachers', '${doc.id}', loadSchedules)">حذف</button></td>
                        </tr>`;
                    tableBody.innerHTML += row;
                });
            } catch (error) { console.error("Error loading schedules: ", error); }
        }
        
        // --- Generic Delete Function ---
        async function deleteDocument(collectionName, docId, reloadFunction) {
            if (confirm('هل أنت متأكد من الحذف؟')) {
                try {
                    await db.collection(collectionName).doc(docId).delete();
                    alert('تم الحذف بنجاح');
                    reloadFunction();
                } catch (error) {
                    console.error("Error deleting document: ", error);
                    alert('حدث خطأ أثناء الحذف');
                }
            }
        }
        
        // --- Logs (Kept simple for now) ---
        function loadLogs() {
            // Placeholder, as we don't have a logs collection in the provided images
        }

    </script>

</body>
</html>
